<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<title>çƒè–©å¥‡Â·å–®å­—è¨ä¼åœ˜ï¼ Yaha!</title>

<!-- çƒè–©å¥‡ GIF Favicon -->
<link rel="icon" href="https://lunakuo1719.github.io/vocab-app/usagi.gif" type="image/gif">

<style>
:root {
    --usagi-yellow: #fffde7;
    --usagi-dark: #5d4037;
    --chiikawa-pink: #ffebee;
    --hachi-blue: #e1f5fe;
    --accent-orange: #ffcc80;
}

* { box-sizing: border-box; font-family: "M PLUS Rounded 1c", "Microsoft JhengHei", sans-serif; transition: 0.3s; }

body {
    margin: 0; padding: 10px; background-color: var(--usagi-yellow);
    display: flex; justify-content: center; align-items: center; min-height: 100vh;
    color: var(--usagi-dark);
}

.card {
    width: 100%; max-width: 500px; background: white;
    border: 4px solid var(--usagi-dark);
    border-radius: 40px; padding: 25px;
    box-shadow: 0px 10px 0px var(--accent-orange);
    position: relative; text-align: center;
}

.usagi-icon {
    width: 140px; height: auto; cursor: pointer;
    animation: bounce 0.6s infinite alternate;
}
@keyframes bounce { from { transform: translateY(0); } to { transform: translateY(-10px); } }
.usagi-shake { animation: shake 0.5s; }
@keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

/* å„€è¡¨æ¿ */
.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
.stat-box { padding: 15px; border-radius: 20px; border: 3px solid var(--usagi-dark); font-weight: bold; }
.stat-box.pink { background: var(--chiikawa-pink); }
.stat-box.blue { background: var(--hachi-blue); }
.stat-val { font-size: 32px; display: block; }

/* é€²åº¦æ¢ */
.bar-outer { height: 20px; background: #eee; border: 3px solid var(--usagi-dark); border-radius: 10px; overflow: hidden; margin: 10px 0; }
.bar-inner { height: 100%; width: 0%; background: linear-gradient(90deg, #fff176, #ffb74d); }

/* é ç¿’èˆ‡é¡Œç›®é¡¯ç¤º */
.word-text { font-size: 46px; font-weight: 900; margin: 10px 0; }
.meaning-text { font-size: 24px; color: #8d6e63; font-weight: bold; background: #fdf5e6; padding: 5px 15px; border-radius: 12px; margin-bottom: 10px; display: inline-block; }
.sentence-box { background: #fffdf0; border: 2px dashed var(--accent-orange); padding: 15px; border-radius: 20px; margin-top: 15px; text-align: left; font-size: 18px; position: relative; }

/* ğŸš€ è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ• */
#spelling-input {
    width: 100%; padding: 18px; font-size: 32px; font-weight: bold;
    border: 4px solid var(--usagi-dark); border-radius: 20px;
    text-align: center; outline: none; margin: 15px 0; -webkit-appearance: none;
}
button { width: 100%; padding: 18px; font-size: 22px; font-weight: 900; border-radius: 22px; border: 3px solid var(--usagi-dark); cursor: pointer; margin-top: 10px; }
.btn-yaha { background: #fff176; box-shadow: 0 5px 0 var(--usagi-dark); }
.btn-yaha:active { transform: translateY(3px); box-shadow: 0 2px 0 var(--usagi-dark); }
.btn-choice { background: white; margin-bottom: 10px; font-size: 18px; }

.speaker-btn { cursor: pointer; font-size: 28px; vertical-align: middle; margin-left: 8px; color: #ffb74d; }
.hidden { display: none; }
.badge { display: inline-block; padding: 5px 15px; border-radius: 10px; background: #ffcc80; font-weight: bold; margin-bottom: 10px; }
</style>
</head>
<body>

<audio id="sound-correct" src="https://lunakuo1719.github.io/vocab-app/ula.mp3"></audio>
<audio id="sound-wrong" src="https://lunakuo1719.github.io/vocab-app/ha.mp3"></audio>
<audio id="sound-usagi" src="https://lunakuo1719.github.io/vocab-app/uulalauula.mp3"></audio>

<div class="card">
    <div class="header-deco">
        <img id="usagi" src="https://lunakuo1719.github.io/vocab-app/usagi.gif" class="usagi-icon" onclick="usagiSpeak()">
    </div>

    <div id="dashboard">
        <h2>å–®å­—è¨ä¼åœ˜ï¼ Yaha!</h2>
        <div class="stats-grid">
            <div class="stat-box pink"><span class="stat-val" id="stat-total">0</span>å·²å­¸æœƒ</div>
            <div class="stat-box blue"><span class="stat-val" id="stat-streak">0</span>é€£çºŒå¤©æ•¸</div>
        </div>
        <div style="font-weight:bold;">âœ¨ ç¸½é€²åº¦: <span id="progress-percent">0</span>%</div>
        <div class="bar-outer"><div class="bar-inner" id="total-bar"></div></div>
        
        <button class="btn-yaha" onclick="initMission('daily')">ğŸ“… ä»Šæ—¥ä»»å‹™ (40å­—)</button>
        <button class="btn-yaha" style="background:#e1f5fe" onclick="initMission('review')">ğŸ”„ å¼±é»è¤‡ç¿’</button>
        <button class="btn-yaha" style="background:#ffebee" onclick="initMission('challenge')">âš¡ 60ç§’æŒ‘æˆ°</button>
    </div>

    <div id="study-zone" class="hidden">
        <div class="badge">é ç¿’ä¸­ (Puru!)</div>
        <div style="font-weight:bold; color:#8d6e63;" id="study-progress">1 / 5</div>
        <div class="word-text" id="study-word">Word</div>
        <div class="meaning-text" id="study-mean">æ„æ€</div>
        <span class="speaker-btn" id="study-word-speak">ğŸ”Š</span>
        <div class="sentence-box">
            <div id="study-sentence">Sentence...</div>
            <div style="text-align:right;"><span class="speaker-btn" id="study-sent-speak">ğŸ”Š</span></div>
        </div>
        <button class="btn-yaha" onclick="nextStudy()">ä¸‹ä¸€å€‹ (å—šæ‹‰æ‹‰!)</button>
    </div>

    <div id="game-zone" class="hidden">
        <div id="mode-badge" class="badge">ä»Šæ—¥ä»»å‹™</div>
        <div id="timer-display" class="hidden" style="color:red; font-size:20px; font-weight:bold;">æ™‚é–“: 60s</div>
        <div id="quiz-progress" style="font-weight:bold; margin-bottom:5px;">é€²åº¦: 1 / 5</div>
        <div class="bar-outer" style="height:12px;"><div class="bar-inner" id="exam-bar"></div></div>
        
        <div class="word-box">
            <div class="word-text"><span id="q-text">Word</span><span class="speaker-btn" onclick="triggerSpeak()">ğŸ”Š</span></div>
            <div class="meaning-text" id="q-sub">æ„æ€è¼‰å…¥ä¸­...</div>
        </div>

        <div id="choices-area"></div>
        <input type="text" id="spelling-input" class="hidden" placeholder="æ‹¼æ‹¼çœ‹..." autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false">
        <button id="confirm-btn" class="btn-yaha hidden" onclick="checkSpelling()">æˆ‘å¯«å¥½äº†ï¼</button>
        <div id="log" style="font-size:14px; margin-top:10px;"></div>
    </div>

    <div id="finish-zone" class="hidden">
        <h2 style="font-size:32px;">ğŸ‰ è¨ä¼æˆåŠŸï¼</h2>
        <div id="finish-stats" style="font-size:22px; line-height:2; font-weight:bold; margin:20px 0;"></div>
        <button class="btn-yaha" id="next-action-btn">ä¸‹ä¸€çµ„åŠ æ²¹ï¼</button>
        <button onclick="location.reload()" style="background:none; border:none; text-decoration:underline; margin-top:15px; cursor:pointer;">å›é¦–é </button>
    </div>
</div>

<script>
const rawData = `
apple,[åè©] è˜‹æœ, I eat an apple. (æˆ‘åƒä¸€å€‹è˜‹æœã€‚)
beach,[åè©] æµ·ç˜, Let's go to the beach. (æˆ‘å€‘å»æµ·ç˜å§ã€‚)
candy,[åè©] ç³–æœ, Don't eat too much candy. (åˆ¥åƒå¤ªå¤šç³–æœã€‚)
drive,[å‹•è©] é–‹è»Š, I learned to drive at twenty. (æˆ‘äºŒåæ­²å­¸é–‹è»Šã€‚)
eight,[åè©] å…«, My sister is eight years old. (æˆ‘å¦¹å¦¹å…«æ­²ã€‚)
know,[å‹•è©] çŸ¥é“, I know the answer. (æˆ‘çŸ¥é“ç­”æ¡ˆã€‚)
young,[å½¢å®¹è©] å¹´è¼•çš„, She is a young girl. (å¥¹æ˜¯ä¸€å€‹å¹´è¼•å¥³å­©ã€‚)
`;

let db = [];
let userStats = JSON.parse(localStorage.getItem('usagi_v7_data')) || { mastered: [], wrongCounts: {}, streak: 0, lastDate: null };
let session = { mode: '', fullPool: [], groupIdx: 0, currentGroup: [], index: 0, correct: 0, wrong: 0, timer: null, timeLeft: 60 };

function init() {
    db = rawData.trim().split("\n").map(line => {
        let [w, m, s] = line.split(",");
        return { word: w.trim(), meaning: m.trim(), sentence: s.trim() };
    });
    updateDashboard();
}

function updateDashboard() {
    document.getElementById('stat-total').innerText = userStats.mastered.length;
    document.getElementById('stat-streak').innerText = userStats.streak || 0;
    let p = Math.round((userStats.mastered.length / db.length) * 100) || 0;
    document.getElementById('total-bar').style.width = p + "%";
    document.getElementById('progress-percent').innerText = p;
}

function initMission(mode) {
    session.mode = mode; session.groupIdx = 0;
    if(mode === 'daily') session.fullPool = shuffle(db).slice(0, 40);
    else if(mode === 'review') session.fullPool = shuffle(db.filter(w => (userStats.wrongCounts[w.word] || 0) > 0)).slice(0, 20);
    else { session.fullPool = shuffle(db); startChallenge(); return; }

    if(session.fullPool.length === 0) return alert("ç›®å‰æ²’æœ‰éŒ¯é¡Œå–”ï¼");
    startNextGroup();
}

function startNextGroup() {
    session.currentGroup = session.fullPool.slice(session.groupIdx, session.groupIdx + 5);
    if(session.currentGroup.length === 0) return location.reload();
    session.index = 0; session.correct = 0; session.wrong = 0;
    showStudy();
}

function showStudy() {
    resetUsagi();
    document.querySelectorAll('.card > div:not(.header-deco)').forEach(d => d.classList.add('hidden'));
    document.getElementById('study-zone').classList.remove('hidden');
    
    let q = session.currentGroup[session.index];
    document.getElementById('study-progress').innerText = `${session.index + 1} / ${session.currentGroup.length}`;
    document.getElementById('study-word').innerText = q.word;
    document.getElementById('study-mean').innerText = q.meaning;
    document.getElementById('study-sentence').innerText = q.sentence;
    
    document.getElementById('study-word-speak').onclick = () => speak(q.word);
    document.getElementById('study-sent-speak').onclick = () => speak(q.sentence.split('(')[0]); // åªè®€è‹±æ–‡éƒ¨åˆ†
    speak(q.word);
}

function nextStudy() {
    session.index++;
    if(session.index < session.currentGroup.length) showStudy();
    else { session.index = 0; startQuiz(); }
}

function startQuiz() {
    document.querySelectorAll('.card > div:not(.header-deco)').forEach(d => d.classList.add('hidden'));
    document.getElementById('game-zone').classList.remove('hidden');
    document.getElementById('mode-badge').innerText = session.mode === 'daily' ? "è¨ä¼é–‹å§‹ï¼" : "å¼±é»è¤‡ç¿’";
    nextQuizQuestion();
}

function nextQuizQuestion() {
    resetUsagi();
    if(session.index >= session.currentGroup.length && session.mode !== 'challenge') return showFinish();
    
    let q = session.currentGroup[session.index];
    let isSpelling = Math.random() > 0.5;
    
    document.getElementById('quiz-progress').innerText = `é€²åº¦: ${session.index + 1} / ${session.currentGroup.length}`;
    document.getElementById('exam-bar').style.width = (session.index / session.currentGroup.length) * 100 + "%";
    document.getElementById('choices-area').innerHTML = "";
    document.getElementById('spelling-input').classList.add('hidden');
    document.getElementById('confirm-btn').classList.add('hidden');

    if(!isSpelling) {
        document.getElementById('q-text').innerText = q.word;
        document.getElementById('q-sub').innerText = "é¸å‡ºæ­£ç¢ºæ„æ€";
        let opts = shuffle(db.filter(x => x.word !== q.word)).slice(0, 3).concat(q);
        shuffle(opts).forEach(opt => {
            let b = document.createElement('button');
            b.className = "btn-choice";
            b.innerText = opt.meaning;
            b.onclick = () => handleAnswer(opt.word === q.word);
            document.getElementById('choices-area').appendChild(b);
        });
    } else {
        document.getElementById('q-text').innerText = "???";
        document.getElementById('q-sub').innerText = q.meaning;
        document.getElementById('spelling-input').classList.remove('hidden');
        document.getElementById('confirm-btn').classList.remove('hidden');
        document.getElementById('spelling-input').value = "";
        setTimeout(() => document.getElementById('spelling-input').focus(), 300);
    }
    speak(q.word);
}

function triggerSpeak() {
    speak(session.currentGroup[session.index].word);
}

function handleAnswer(isCorrect) {
    let q = session.currentGroup[session.index];
    const usagi = document.getElementById('usagi');
    if(isCorrect) {
        session.correct++;
        if(!userStats.mastered.includes(q.word)) userStats.mastered.push(q.word);
        usagi.className = "usagi-icon usagi-shake";
        document.getElementById('sound-correct').play();
    } else {
        session.wrong++;
        userStats.wrongCounts[q.word] = (userStats.wrongCounts[q.word] || 0) + 1;
        document.getElementById('sound-wrong').play();
        usagi.src = "https://lunakuo1719.github.io/vocab-app/usagi-ha.gif";
    }
    session.index++;
    saveData();
    setTimeout(nextQuizQuestion, 1200);
}

function checkSpelling() {
    let q = session.currentGroup[session.index];
    handleAnswer(document.getElementById('spelling-input').value.trim().toLowerCase() === q.word.toLowerCase());
}

function showFinish() {
    document.querySelectorAll('.card > div:not(.header-deco)').forEach(d => d.classList.add('hidden'));
    document.getElementById('finish-zone').classList.remove('hidden');
    document.getElementById('finish-stats').innerHTML = `æœ¬çµ„ç­”å°ï¼š${session.correct}<br>ç­”éŒ¯ï¼š${session.wrong}`;
    
    session.groupIdx += 5;
    let btn = document.getElementById('next-action-btn');
    if(session.groupIdx >= session.fullPool.length) {
        btn.innerText = "å…¨éƒ¨å®Œæˆï¼å›é¦–é ";
        btn.onclick = () => location.reload();
        updateStreak();
    } else {
        btn.innerText = "ä¸‹ä¸€çµ„é ç¿’ (Puru!)";
        btn.onclick = startNextGroup;
    }
}

function updateStreak() {
    let today = new Date().toLocaleDateString();
    if (userStats.lastDate !== today && session.mode === 'daily') {
        userStats.streak = (userStats.streak || 0) + 1;
        userStats.lastDate = today;
        saveData();
    }
}

function startChallenge() {
    session.currentGroup = shuffle(db);
    session.index = 0; session.correct = 0; session.wrong = 0; session.timeLeft = 60;
    document.querySelectorAll('.card > div:not(.header-deco)').forEach(d => d.classList.add('hidden'));
    document.getElementById('game-zone').classList.remove('hidden');
    document.getElementById('timer-display').classList.remove('hidden');
    session.timer = setInterval(() => {
        session.timeLeft--;
        document.getElementById('timer-display').innerText = `æ™‚é–“: ${session.timeLeft}s`;
        if(session.timeLeft <= 0) { clearInterval(session.timer); showFinish(); }
    }, 1000);
    nextQuizQuestion();
}

function resetUsagi() {
    const usagi = document.getElementById('usagi');
    usagi.className = "usagi-icon";
    usagi.src = "https://lunakuo1719.github.io/vocab-app/usagi.gif";
}
function speak(t) { window.speechSynthesis.cancel(); let u = new SpeechSynthesisUtterance(t); u.lang = "en-US"; u.rate = 0.8; window.speechSynthesis.speak(u); }
function shuffle(arr) { return [...arr].sort(() => Math.random() - 0.5); }
function saveData() { localStorage.setItem('usagi_v7_data', JSON.stringify(userStats)); }
function usagiSpeak() { document.getElementById('sound-usagi').play(); }

init();
</script>
</body>
</html>
