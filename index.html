<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<title>â˜ªï¸ åœ‹ä¸­2000å–®å­—å­¸ç¿’(Ëƒá†ºË‚)</title>
<style>
:root{
  --bg:#0a0a0c; --card:#1c1b1e; --main:#ffffff; --soft:#a19ba8;
  --accent:#c7b6c8; --highlight:#9bc1ff; --success:#81c784; --error:#e57373;
}
*{box-sizing:border-box; transition: 0.3s;}
body{
  margin:0; padding:16px; background:var(--bg); color:var(--main);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  touch-action: manipulation;
}
.card{
  max-width:500px; margin:auto; background:var(--card);
  border-radius:28px; padding:24px; box-shadow: 0 10px 30px rgba(0,0,0,0.5);
}
h2{text-align:center; margin:0 0 15px; font-size:24px; color:var(--accent);}

/* å„€è¡¨æ¿æ¨£å¼ */
.stats-grid{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-bottom:20px; }
.stat-box{ background:rgba(255,255,255,0.05); padding:12px; border-radius:16px; text-align:center; }
.stat-val{ font-size:22px; font-weight:bold; color:var(--accent); }
.stat-label{ font-size:12px; color:var(--soft); }

/* é€²åº¦æ¢æ¨£å¼ */
.progress-container{ margin: 15px 0; }
.progress-text{ font-size: 14px; color: var(--highlight); text-align: center; margin-bottom: 5px; font-weight: bold; }
.progress-wrap{ height:8px; background:#333; border-radius:4px; overflow:hidden; }
.progress-fill{ height:100%; background:linear-gradient(90deg,#ccb8c1,#9bc1ff); width:0%; }

/* é¡Œç›®æ¨£å¼ */
.word-display{ font-size:36px; font-weight:700; text-align:center; margin:15px 0; display: flex; justify-content: center; align-items: center; gap: 10px;}
.meaning-display{ font-size:20px; color:var(--soft); text-align:center; margin-bottom:15px; line-height: 1.5;}

button{ width:100%; padding:14px; font-size:18px; border-radius:14px; border:none; cursor:pointer; margin-top:10px; font-weight:600; }
.btn-main{ background:var(--accent); color:#222; }
.btn-choice{ background:rgba(255,255,255,0.1); color:var(--main); text-align:left; padding-left:20px; border: 1px solid transparent;}
.btn-choice:hover{ background:rgba(255,255,255,0.2); border-color: var(--accent); }
.btn-finish{ background:var(--success); color:#fff; }
.btn-speak{ width:auto; padding:8px 20px; background:#4a4458; color:white; font-size:16px; margin: 10px auto; display: block;}

/* è¼¸å…¥æ¡†å„ªåŒ– (é˜²æ­¢ iPhone é æ¸¬) */
input{
  width:100%; padding:15px; font-size:24px; border-radius:12px; border:2px solid #333;
  background:#111; color:#fff; text-align:center; outline:none;
}
input:focus{ border-color:var(--accent); background:#000; }

.hidden{ display:none; }
#log{ font-size:12px; color:var(--soft); margin-top:15px; text-align:center; border-top: 1px solid #333; padding-top: 5px;}
.badge{ display:inline-block; padding:4px 12px; border-radius:10px; background:var(--highlight); color:#000; font-size:12px; margin-bottom:10px;}
.speaker-icon{ cursor: pointer; color: var(--highlight); }
</style>
</head>
<body>

<div class="card">
    <div id="dashboard">
        <h2>â˜ªï¸ åœ‹ä¸­2000å–®å­—å­¸ç¿’(Ëƒá†ºË‚)</h2>
        <div class="stats-grid">
            <div class="stat-box"><div class="stat-val" id="stat-total">0</div><div class="stat-label">å·²å­¸æœƒå–®å­—</div></div>
            <div class="stat-box"><div class="stat-val" id="stat-streak">0</div><div class="stat-label">é€£çºŒé”æ¨™å¤©</div></div>
        </div>
        <div class="progress-container">
            <p class="progress-text">ç¸½åº«é€²åº¦: <span id="progress-percent">0</span>%</p>
            <div class="progress-wrap"><div class="progress-fill" id="total-bar"></div></div>
        </div>
        
        <button class="btn-main" onclick="startDaily()">ğŸ“… é–‹å§‹ä»Šæ—¥ä»»å‹™ (40å­—)</button>
        <button class="btn-main" style="background:#8e9aaf" onclick="startReview()">ğŸ”„ å¼±é»è¤‡ç¿’æ¨¡å¼</button>
        <button class="btn-main" style="background:#b8c0ff" onclick="startChallenge()">âš¡ 60ç§’é™æ™‚æŒ‘æˆ°</button>
    </div>

    <div id="game-zone" class="hidden">
        <div id="mode-badge" class="badge">ä»Šæ—¥ä»»å‹™</div>
        
        <div class="progress-container">
            <div id="task-progress-text" class="progress-text">ç¬¬ 0 / 0 é¡Œ</div>
            <div class="progress-wrap"><div class="progress-fill" id="exam-bar"></div></div>
        </div>

        <div id="timer-display" class="hidden" style="text-align:center; color:var(--error); font-weight:bold; margin-bottom:10px;">æ™‚é–“: 60s</div>
        
        <div id="question-container">
            <div id="q-text" class="word-display">Word</div>
            <div id="q-subtext" class="meaning-display">è¼‰å…¥ä¸­...</div>
            <div id="choices-area"></div>
            
            <input type="text" id="spelling-input" class="hidden" 
                   placeholder="è«‹æ‹¼å‡ºå–®å­—..." autocomplete="off" autocorrect="off" 
                   autocapitalize="none" spellcheck="false">
            
            <button id="confirm-btn" class="btn-main hidden" onclick="checkAnswer()">ç¢ºèªç­”æ¡ˆ</button>
        </div>
        
        <div id="log"></div>
        <button onclick="exitGame()" style="background:transparent; color:var(--soft); font-size:14px; margin-top:20px;">âœ• æ”¾æ£„é€€å‡º</button>
    </div>

    <div id="finish-zone" class="hidden" style="text-align:center;">
        <h2 id="finish-title">ğŸ‰ ä»»å‹™å®Œæˆï¼</h2>
        <div class="stat-box" style="margin:20px 0;">
            <div id="finish-stats" style="font-size:18px; line-height:2;"></div>
        </div>
        <button class="btn-finish" onclick="showDashboard()">å›ä¸»é¸å–®</button>
    </div>
</div>

<script>
/* å–®å­—åº« (æ¸¬è©¦ç”¨) */
const rawData = `
a,[å† è©] ä¸€å€‹;ä¸€ç¨®, I have a dream.
a few,[ç‰‡èª] ä¸€äº›, I have a few cookies.
a little,[ç‰‡èª] ä¸€é»é», Please give me a little water.
a lot,[ç‰‡èª] å¾ˆå¤š, He has a lot of toys.
A.M.,[å‰¯è©] ä¸Šåˆ, It is 8:00 A.M.
able,[å½¢å®¹è©] æœ‰èƒ½åŠ›çš„, She is able to speak English.
about,[ä»‹ç³»è©] å¤§ç´„;é—œæ–¼, Let's talk about your day.
any,[å½¢å®¹è©] ä»»ä½•çš„, Do you have any questions?
anybody,[ä»£åè©] ä»»ä½•äºº, Does anybody know the answer?
be,[å‹•è©] æ˜¯;åœ¨, I want to be a pilot.
beach,[åè©] æµ·ç˜, Let's go to the beach.
bus,[åè©] å…¬è»Š, I go to work by bus.
candy,[åè©] ç³–æœ, Don't eat too much candy.
cute,[å½¢å®¹è©] å¯æ„›çš„, Your baby is so cute!
dad,[åè©] çˆ¶è¦ª, My dad is a teacher.
drink,[å‹•è©] å–, What do you want to drink?
drive,[å‹•è©] é–‹è»Š, I learned to drive at twenty.
easy,[å½¢å®¹è©] å®¹æ˜“çš„, This question is very easy.
eat,[å‹•è©] åƒ, I like to eat apples.
egg,[åè©] è›‹, I want a fried egg.
eight,[åè©] å…«, My sister is eight years old.
family,[åè©] å®¶åº­, I love my family.
fast,[å½¢å®¹è©] å¿«çš„, He runs very fast.
fat,[å½¢å®¹è©] èƒ–çš„, My cat is getting fat.
father,[åè©] çˆ¶è¦ª, My father is a doctor.
hello,[æ„Ÿæ­è©] å“ˆå›‰, Hello, how are you?
help,[å‹•è©] å¹«å¿™, Can you help me?
her,[ä»£åè©] å¥¹, I know her.
here,[å‰¯è©] åœ¨é€™è£¡, Come here.
hero,[åè©] è‹±é›„, He is my hero.
know,[å‹•è©] çŸ¥é“, I know the answer.
mail,[åè©] ä¿¡ä»¶, Is there any mail for me?
many,[å½¢å®¹è©] å¾ˆå¤šçš„, How many friends do you have?
map,[åè©] åœ°åœ–, Look at the map.
march,[åè©] ä¸‰æœˆ, My birthday is in March.
mark,[åè©] è¨˜è™Ÿ, I got a high mark.
name,[åè©] åå­—, What's your name?
only,[å‰¯è©] åª, I only have five dollars.
open,[å‹•è©] æ‰“é–‹, Please open the window.
word,[åè©] å­—, What is this word?
work,[å‹•è©] å·¥ä½œ, He works in a bank.
you,[ä»£åè©] ä½ , You are my friend.
young,[å½¢å®¹è©] å¹´è¼•çš„, She is a young girl.
your,[ä»£åè©] ä½ çš„, Is this your bag?
`;

let db = [];
let userStats = JSON.parse(localStorage.getItem('vocab_v4_stats')) || { mastered: [], wrongCounts: {}, streak: 0, lastDate: null };

function initDB() {
    db = rawData.trim().split("\n").map(line => {
        let [w, m, s] = line.split(",");
        return { word: w.trim(), meaning: m.trim(), sentence: s.trim() };
    });
    showDashboard();
}

let currentGame = { mode: '', pool: [], index: 0, correct: 0, wrong: 0, timer: null, timeLeft: 60 };

function showDashboard() {
    document.getElementById('dashboard').classList.remove('hidden');
    document.getElementById('game-zone').classList.add('hidden');
    document.getElementById('finish-zone').classList.add('hidden');
    document.getElementById('stat-total').innerText = userStats.mastered.length;
    document.getElementById('stat-streak').innerText = userStats.streak || 0;
    let progress = Math.round((userStats.mastered.length / db.length) * 100) || 0;
    document.getElementById('total-bar').style.width = progress + "%";
    document.getElementById('progress-percent').innerText = progress;
}

function startDaily() {
    currentGame = { mode: 'daily', pool: pick(db, Math.min(db.length, 40)), index: 0, correct: 0, wrong: 0 };
    setupGame("ä»Šæ—¥ä»»å‹™");
}

function startReview() {
    let wrongWords = db.filter(w => (userStats.wrongCounts[w.word] || 0) > 0);
    if (wrongWords.length < 2) { alert("ç›®å‰é‚„æ²’æœ‰éŒ¯é¡Œç´€éŒ„ï¼"); return; }
    currentGame = { mode: 'review', pool: shuffle(wrongWords).slice(0, 20), index: 0, correct: 0, wrong: 0 };
    setupGame("å¼±é»è¤‡ç¿’");
}

function startChallenge() {
    currentGame = { mode: 'challenge', pool: shuffle(db), index: 0, correct: 0, wrong: 0, timeLeft: 60 };
    setupGame("é™æ™‚æŒ‘æˆ°");
    startTimer();
}

function setupGame(title) {
    document.getElementById('dashboard').classList.add('hidden');
    document.getElementById('game-zone').classList.remove('hidden');
    document.getElementById('mode-badge').innerText = title;
    document.getElementById('log').innerHTML = "";
    nextQuestion();
}

function nextQuestion() {
    // æª¢æŸ¥æ˜¯å¦çµæŸ
    if (currentGame.mode !== 'challenge' && currentGame.index >= currentGame.pool.length) { finishGame(); return; }
    
    let q = currentGame.pool[currentGame.index];
    let qText = document.getElementById('q-text');
    let qSub = document.getElementById('q-subtext');
    let choicesArea = document.getElementById('choices-area');
    let inputArea = document.getElementById('spelling-input');
    let confirmBtn = document.getElementById('confirm-btn');

    // æ›´æ–°ä»»å‹™é€²åº¦é¡¯ç¤º (ç¬¬ X / Y é¡Œ)
    let currentNum = currentGame.index + 1;
    let totalNum = currentGame.pool.length;
    if (currentGame.mode === 'challenge') {
        document.getElementById('task-progress-text').innerText = `å·²æŒ‘æˆ° ${currentGame.index} é¡Œ`;
        document.getElementById('exam-bar').style.width = "100%";
    } else {
        document.getElementById('task-progress-text').innerText = `ç¬¬ ${currentNum} / ${totalNum} é¡Œ`;
        document.getElementById('exam-bar').style.width = (currentGame.index / totalNum) * 100 + "%";
    }

    choicesArea.innerHTML = "";
    inputArea.classList.add('hidden');
    confirmBtn.classList.add('hidden');

    // æ±ºå®šé¡Œå‹
    let isSpelling = (currentGame.mode !== 'challenge' && Math.random() > 0.5);

    if (!isSpelling) {
        qText.innerHTML = `${q.word} <span class="speaker-icon" onclick="speak('${q.word.replace(/'/g,"\\'")}')">ğŸ”Š</span>`;
        qSub.innerText = "è«‹é¸æ“‡æ­£ç¢ºæ„æ€";
        let opts = pick(db.filter(x => x.word !== q.word), 3).concat(q);
        shuffle(opts).forEach(opt => {
            let btn = document.createElement('button');
            btn.className = "btn-choice";
            btn.innerText = opt.meaning;
            btn.onclick = () => handleAnswer(opt.word === q.word);
            choicesArea.appendChild(btn);
        });
    } else {
        qText.innerText = q.meaning;
        qSub.innerHTML = `è«‹æ‹¼å‡ºè‹±æ–‡å–®å­—<br><button class="btn-speak" onclick="speak('${q.word.replace(/'/g,"\\'")}')">ğŸ”Š è½ç™¼éŸ³</button>`;
        inputArea.classList.remove('hidden');
        confirmBtn.classList.remove('hidden');
        inputArea.value = "";
        setTimeout(()=>inputArea.focus(), 200);
    }
    speak(q.word);
}

function handleAnswer(isCorrect) {
    let q = currentGame.pool[currentGame.index];
    if (isCorrect) {
        currentGame.correct++;
        if (!userStats.mastered.includes(q.word)) userStats.mastered.push(q.word);
        logMsg(`âœ… ${q.word}`);
    } else {
        currentGame.wrong++;
        userStats.wrongCounts[q.word] = (userStats.wrongCounts[q.word] || 0) + 1;
        logMsg(`âŒ ${q.word}`);
    }
    saveData();
    currentGame.index++;
    if (currentGame.mode === 'challenge' && currentGame.index >= currentGame.pool.length) finishGame();
    else setTimeout(nextQuestion, 250);
}

function checkAnswer() {
    let q = currentGame.pool[currentGame.index];
    handleAnswer(document.getElementById('spelling-input').value.trim().toLowerCase() === q.word.toLowerCase());
}

function startTimer() {
    let display = document.getElementById('timer-display');
    display.classList.remove('hidden');
    currentGame.timer = setInterval(() => {
        currentGame.timeLeft--;
        display.innerText = `æ™‚é–“: ${currentGame.timeLeft}s`;
        if (currentGame.timeLeft <= 0) { clearInterval(currentGame.timer); finishGame(); }
    }, 1000);
}

function finishGame() {
    clearInterval(currentGame.timer);
    document.getElementById('game-zone').classList.add('hidden');
    document.getElementById('finish-zone').classList.remove('hidden');
    let today = new Date().toLocaleDateString();
    if (userStats.lastDate !== today && currentGame.mode === 'daily') {
        userStats.streak = (userStats.streak || 0) + 1;
        userStats.lastDate = today;
        saveData();
    }
    document.getElementById('finish-stats').innerHTML = `ç­”å°ï¼š<span style="color:var(--success)">${currentGame.correct}</span><br>ç­”éŒ¯ï¼š<span style="color:var(--error)">${currentGame.wrong}</span>`;
}

function pick(arr, n) { return shuffle([...arr]).slice(0, n); }
function shuffle(arr) { return arr.sort(() => Math.random() - 0.5); }
function logMsg(msg) { document.getElementById('log').innerHTML = msg + " | " + document.getElementById('log').innerHTML; }
function speak(t) { window.speechSynthesis.cancel(); let u = new SpeechSynthesisUtterance(t); u.lang = "en-US"; u.rate = 0.8; window.speechSynthesis.speak(u); }
function saveData() { localStorage.setItem('vocab_v4_stats', JSON.stringify(userStats)); }
function exitGame() { if (confirm("è¦é›¢é–‹å—ï¼Ÿ")) { clearInterval(currentGame.timer); showDashboard(); } }

document.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        const input = document.getElementById('spelling-input');
        if (!input.classList.contains('hidden')) checkAnswer();
    }
});

initDB();
</script>
</body>
</html>
